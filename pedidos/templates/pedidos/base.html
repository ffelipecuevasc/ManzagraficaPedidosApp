<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Manzagrafica App{% endblock %}</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#FBBF24", // Amarillo Manzagrafica
                        "background-light": "#F9FAFB",
                        "background-dark": "#0A0A0A",
                        "card-dark": "#171717",
                        "border-dark": "#262626"
                    },
                    fontFamily: {
                        display: ["Bebas Neue", "sans-serif"],
                        sans: ["Inter", "sans-serif"],
                    },
                },
            },
        };
    </script>

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">

    <style>
        /* Ajustes mínimos para coexistencia */
        body { font-family: 'Inter', sans-serif; }
        .display-font { font-family: 'Bebas Neue', cursive; }

        /* Corrección temporal para Select2 en Tailwind */
        .select2-container .select2-selection--single { height: 38px !important; border-color: #d1d5db !important; }
        .select2-container--default .select2-selection--single .select2-selection__rendered { line-height: 38px !important; }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 h-screen flex overflow-hidden">

    <aside class="w-64 border-r border-slate-200 dark:border-border-dark flex flex-col fixed h-full bg-white dark:bg-background-dark z-50 transition-colors duration-300">
        <div class="p-6">
            <div class="flex flex-col">
                <span class="display-font text-3xl tracking-tight text-slate-900 dark:text-white">
                    MANZA <span class="bg-primary text-black px-1">GRÁFICA</span>
                </span>
                <span class="text-[10px] tracking-[0.2em] font-medium opacity-60 mt-1 text-slate-500 dark:text-slate-400">DISEÑO Y PUBLICIDAD</span>
            </div>
        </div>

        <nav class="flex-1 px-4 space-y-2 mt-4 overflow-y-auto">
            <a href="{% url 'dashboard' %}" class="flex items-center px-4 py-3 text-sm font-medium rounded-md hover:bg-slate-100 dark:hover:bg-card-dark transition-colors {% if request.resolver_match.url_name == 'dashboard' %}bg-primary/10 text-primary{% else %}text-slate-600 dark:text-slate-400{% endif %}">
                <span class="material-icons-round mr-3">dashboard</span>
                Panel de Control
            </a>

            <div class="pt-4 pb-2">
                <p class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider">Gestión Pedidos</p>
            </div>

            <a href="{% url 'lista_pedidos' %}" class="flex items-center px-4 py-3 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-card-dark transition-colors">
                <span class="material-icons-round mr-3">list_alt</span>
                Listado de Pedidos
            </a>

            <a href="{% url 'crear_pedido' %}" class="flex items-center px-4 py-3 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-card-dark transition-colors">
                <span class="material-icons-round mr-3">add_circle_outline</span>
                Nuevo Pedido
            </a>

            <div class="pt-4 pb-2">
                <p class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider">Gestión Clientes</p>
            </div>
            <a href="{% url 'lista_clientes' %}" class="flex items-center px-4 py-3 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-card-dark transition-colors">
                <span class="material-icons-round mr-3">people</span>
                Directorio Clientes
            </a>
            <a href="{% url 'crear_cliente' %}" class="flex items-center px-4 py-3 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-card-dark transition-colors">
                <span class="material-icons-round mr-3">person_add</span>
                Agregar Cliente
            </a>
        </nav>

        <div class="p-4 border-t border-slate-200 dark:border-border-dark bg-slate-50 dark:bg-card-dark/50">
            {% if user.is_authenticated %}
            <div class="flex items-center mb-4 px-2">
                <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-black font-bold text-xs mr-3">
                    {{ user.username|slice:":2"|upper }}
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-slate-900 dark:text-white truncate">{{ user.username }}</p>
                    <form action="{% url 'logout' %}" method="post" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="text-xs text-slate-500 hover:text-red-500 transition-colors">Cerrar Sesión</button>
                    </form>
                </div>
            </div>
            {% else %}
            <a href="{% url 'login' %}" class="block text-center py-2 px-4 border border-slate-300 dark:border-border-dark rounded-md text-sm font-medium hover:bg-slate-100 dark:hover:bg-card-dark transition-colors">
                Iniciar Sesión
            </a>
            {% endif %}

            <button id="theme-toggle" class="flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-card-dark rounded-md transition-colors">
                <span class="material-icons-round mr-2 text-lg dark:hidden">dark_mode</span>
                <span class="material-icons-round mr-2 text-lg hidden dark:block">light_mode</span>
                <span class="dark:hidden">Modo Oscuro</span>
                <span class="hidden dark:block">Modo Claro</span>
            </button>
        </div>
    </aside>

    <main class="ml-64 flex-1 h-full overflow-y-auto bg-background-light dark:bg-background-dark p-8 transition-colors duration-300">
        {% block content %}
        {% endblock %}

        <footer class="mt-12 py-6 border-t border-slate-200 dark:border-border-dark text-center">
            <p class="text-xs text-slate-500 dark:text-slate-500 uppercase tracking-widest font-medium">
                © 2026 MANZA GRÁFICA - SISTEMA DESARROLLADO POR FELIPE CUEVAS
            </p>
        </footer>
    </main>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

    <script>
        const themeToggleBtn = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;

        // Verificar preferencia guardada
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            htmlElement.classList.add('dark');
        } else {
            htmlElement.classList.remove('dark');
        }

        themeToggleBtn.addEventListener('click', function() {
            if (htmlElement.classList.contains('dark')) {
                htmlElement.classList.remove('dark');
                localStorage.setItem('color-theme', 'light');
            } else {
                htmlElement.classList.add('dark');
                localStorage.setItem('color-theme', 'dark');
            }
        });
    </script>

    <script>
        $(document).ready(function() {
            $('.select2').select2({ width: '100%' });
        });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>